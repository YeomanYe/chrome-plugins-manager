(function(){function t(){var t=i();SubTask("Extension",function(a){_=a;for(var i=[],o=[],n=[],s=0;s<a.length;s++){var l=a[s];if(l.id!==chrome.app.getDetails().id&&"theme"!==l.type){var d="";d=l.icons&&l.icons.length>0?l.icons[l.icons.length-1].url:v;var g="";t&&1==t[l.id]&&(g="locked");var u='<li data-id="'+l.id+'" data-homepageurl="'+l.homepageUrl+'" data-optionurl="'+l.optionsUrl+'" data-name="'+l.shortName+'" style="background-image:url('+d+')" '+g+"></li>";l.icons&&l.icons.length>0&&function(t,e){setTimeout(function(){r(t,e.id)},0)}(l.icons[0].url,l),l.enabled===!1?n.push(u):"locked"===g?o.unshift(u):i.push(u)}}Storage.get("_switch_rank_sort_")||(i.sort(function(t,e){return b.get($(e).data("id"))-b.get($(t).data("id"))}),n.sort(function(t,e){return b.get($(e).data("id"))-b.get($(t).data("id"))}));var f=o.concat(i);c.html(f.join("")),0===n.length&&(c.addClass("hideListIsNull"),0===f.length&&m.addClass("allListIsEmpty")),h.html(n.join("")),e()})}function e(){if(!Storage.get("_switch_show_badge_")){var t=i(),e=0;$("#showList li").each(function(a,i){var o=$(i).data("id");t&&"1"!==t[o]&&e++}),0===e?chrome.browserAction.setBadgeText({text:""}):(chrome.browserAction.setBadgeBackgroundColor({color:"#f44336"}),chrome.browserAction.setBadgeText({text:e+""}))}}function a(){var t=$("[data-right]");t.length>0&&(t.removeAttr("data-right").removeClass("hover"),u.removeAttr("style")),$(".dinginess").removeClass("dinginess"),g.removeClass("extName-anim").attr("style","").empty()}function i(){return Storage.get("_lockList_")||{}}function o(){if(!y){y=setTimeout(function(){clearTimeout(y),y=null},1e3);var t=c.find("li");t.each(function(t,e){var a=$(e),i=a.data("id");""!==a.attr("locked")&&(h.append(a),chrome.management.setEnabled(i,!1,function(){}))}),chrome.browserAction.setBadgeText({text:""});var e=$("#showList li[locked]").removeAttr("locked");setTimeout(function(){e.attr("locked","")},0)}}function r(t,e){function a(t){var a=document.getElementById("getColorByCanvas");a.width=t.width,a.height=t.height;var i=a.getContext("2d");i.drawImage(t,0,0);for(var o=i.getImageData(0,0,t.width,t.height).data,r=0,n=0,s=0,l=180,d=1e3,c=0;c<t.height;c++)for(var h=0;h<t.width;h++){var m=o[4*(t.width*c+h)],g=o[4*(t.width*c+h)+1],u=o[4*(t.width*c+h)+2];255!=m&&255!=g&&255!=u&&h<d&&(d=h),m>l&&g>l&&u>l||(r+=m,n+=g,s+=u)}r/=t.width*t.height,n/=t.width*t.height,s/=t.width*t.height,r=Math.round(r),n=Math.round(n),s=Math.round(s);var p="rgb("+r+","+n+","+s+")";return r>l&&n>l&&s>l&&(p=f),1e3===d&&(setTimeout(function(){$("[data-id="+e+"]").css({"background-image":"url("+v+")"})},0),p=f),{color:p,substantial:d}}var i=new Image;i.crossOrigin="Anonymous",i.src=t,i.onload=function(){var t=a(i);x[e]||(x[e]={}),x[e].color=t.color,x[e].substantial=t.substantial}}document.title=chrome.i18n.getMessage("extName");var n=$("body"),s=$(".js-dblclick-btn"),l=$(".js-searcher");n.attr("data-lan",chrome.i18n.getMessage("@@ui_locale")),$("#tips .title").html(chrome.i18n.getMessage("tipsTitle")),$("#tips .con").html(chrome.i18n.getMessage("tipsCon")),$("#rightMenu li.option").html(chrome.i18n.getMessage("rightOption")),$("#rightMenu li.uninstall").html(chrome.i18n.getMessage("rightUninstall")),$("#rightMenu li.homepage").html(chrome.i18n.getMessage("rightHomepage")),s.html(chrome.i18n.getMessage("closeAllBtn")),l.attr("placeholder",chrome.i18n.getMessage("searcherPlaceholder"));var d=$("#tips .url");d.html(chrome.i18n.getMessage("tipsUrl")),d.attr("href",d.attr("href")+chrome.i18n.getMessage("@@ui_locale"));var c=$("#showList"),h=$("#hideList"),m=$("#wrap"),g=$("#extName"),u=$("#rightMenu"),f="#5c5e6f",v="../icon/default-icon.png",p=null,w=null,k=null,_=null,b=null;SubTask("Storage",function(e){b={_key:"_rankList_",get:function(t){var a=e.get(this._key),i=0;return a&&a[t]&&(i=parseInt(a[t])),i},setRank:function(t){var a=e.get(this._key)||{};a[t]?a[t]=parseInt(a[t])+1:a[t]=1,e.set(this._key,a)}},p="close"!==e.get("_switch_show_extname_"),w="close"!==e.get("_switch_right_more_"),k=e.get("_showIconSize_")||2,t()}),m.on("click","li",function(t){t.preventDefault();var a=$(this),i=a.data("id"),o=1===a.closest("#hideList").length;i&&a.hasClass("hover")&&(a.removeClass("hover"),g.removeClass("extName-anim").attr("style","").empty(),o?(c.append(a),b.setRank(i)):h.append(a),a.attr("data-leftClick",1*new Date),0===h.find("li").length?c.addClass("hideListIsNull"):c.removeClass("hideListIsNull"),chrome.management.setEnabled(i,o,function(){})),e()}),$(document).on("click",function(){a()});var C={1:18,2:22,3:26};m.on("mouseenter","li",function(){var t=$(this),e=t.attr("data-id"),a=$("[data-right]"),i=a.attr("data-id");if(void 0===m.attr("searching")||void 0!=t.attr("searched")){if(e===i)return!1;if(a.length>0){a.removeAttr("data-right").removeClass("hover"),u.removeAttr("style");var o=t.closest("#showList").length>0?$("#hideList"):$("#showList");o.removeClass("dinginess")}var r="right",s=t.offset(),l=s.left+50-10,d=l+C[k],c=t.outerWidth(),h=t.outerHeight(),f=n.outerWidth(),v=g.html(t.attr("data-name")).outerWidth(),w=u.outerWidth(),_=u.outerHeight(),b=Math.max(v,w),y=f-s.left-c-C[k]+10,M=s.left-C[k]+10,A=Math.max(M,y);b>y&&y<M&&(l=s.left-v+10,d=l>C[k]?l-C[k]:0,r="left"),v>A&&(v=A-6,g.css({width:v,overflow:"hidden","text-overflow":"ellipsis"}),"left"==r&&(d+=6)),x[e]||(x[e]={}),x[e].left1=l,x[e].left2=d,"left"==r&&(x[e].left1=v>w?l+(v-w):l-(w-v),x[e].left2=v>w?d+(v-w):d-(w-v)),x[e].top=_>h?s.top-(_-h)/2:s.top+(h-_)/2,x[e]&&g.css("background-color",x[e].color),g.css({top:s.top+15,left:l});var L=t.closest(".list");clearTimeout(window["timer_disable_dinginess_"+L.attr("id")]),window["timer_"+t.data("id")]=setTimeout(function(){1*new Date<1*t.attr("data-leftclick")+200||(t.addClass("hover"),p&&(L.addClass("dinginess"),g.addClass("extName-anim").css({left:d,opacity:1})))},100)}}).on("mouseleave","li",function(){var t=$(this),e=t.closest(".list");return void 0==t.attr("data-right")&&(p&&(window["timer_disable_dinginess_"+e.attr("id")]=setTimeout(function(){e.removeClass("dinginess")},300),g.removeClass("extName-anim").attr("style","").empty()),t.removeClass("hover"),void clearTimeout(window["timer_"+t.data("id")]))});var y=null;s.click(function(){o()}),l.focus(),l.on("input",function(){var t=$(this),e=t.val().trim().replace(/\s{2,}/g," ").toLowerCase(),a={};if($("[searched]").removeAttr("searched"),e){m.attr("searching","");for(var i=e.split(/\s/),o=_.length-1;o>=0;o--)for(var r=i.length-1;r>=0;r--){var n=(_[o].name+"  "+_[o].description).toLowerCase();n.indexOf(i[r])!==-1&&(a[_[o].id]=1)}for(var s in a)$("[data-id="+s+"]").attr("searched","")}else m.removeAttr("searching")}).hover(function(){$(this).select()},function(){}),n.on("click",function(t){$.contains(document.getElementById("searchBox"),t.target)||(l.val(""),m.removeAttr("searching"))}),$(".js-search-empty").on("click",function(){l.val(""),m.removeAttr("searching"),l.focus()}),$(document).on("mousedown","#hideList>li, #showList>li",function(t){var e=$(this),i=e.data("id"),o=void 0!=e.attr("locked"),r=e.data("optionurl"),n=e.data("homepageurl"),s=$("[data-right]");s.length>0&&s.data("id")===i&&a(),2===t.button&&e.hasClass("hover")&&w&&(g.removeClass("extName-anim").attr("style","").empty(),e.attr("data-right",""),u.css({"background-color":x[i]?x[i].color:f,top:x[i].top,left:x[i].left1}).show(),o?u.find("li.lock").attr("locked",""):u.find("li.lock").removeAttr("locked"),$.trim(r)?u.find("li.option").removeAttr("disabled"):u.find("li.option").attr("disabled",""),$.trim(n)?u.find("li.homepage").removeAttr("disabled"):u.find("li.homepage").attr("disabled",""),setTimeout(function(){u.css({left:x[i].left2,opacity:1})},0))}),$(document).on("contextmenu",function(t){return!1}),$("#rightMenu").on("click","li",function(t){t.preventDefault(),t.stopPropagation();var o=$(this),r=$("[data-right]"),n=r.attr("data-id");switch(a(),o.attr("class")){case"lock":var s=i();void 0===o.attr("locked")?(r.attr("locked",""),s[n]="1"):(r.removeAttr("locked"),delete s[n]),Storage.set("_lockList_",s),e();break;case"option":void 0===o.attr("disabled")&&chrome.tabs.create({url:r.data("optionurl")});break;case"homepage":void 0===o.attr("disabled")&&chrome.tabs.create({url:r.data("homepageurl")});break;case"uninstall":chrome.management.uninstall(n,function(){})}});var x={}})();