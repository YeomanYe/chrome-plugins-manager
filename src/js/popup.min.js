(function(){function t(){var t=i();SubTask("Extension",function(a){function i(){return function(t,e){return b.get($(e).data("id"))-b.get($(t).data("id"))}}function o(){return function(t,e){var a=$(t).data("name").charAt(0),i=$(e).data("name").charAt(0);return a.localeCompare(i,"zh-Hans-CN",{sensitivity:"accent",usage:"search"})}}_=a;for(var n=[],s=[],l=[],c=0;c<a.length;c++){var u=a[c];if(u.id!==chrome.app.getDetails().id&&"theme"!==u.type){var g="";g=u.icons&&u.icons.length>0?u.icons[u.icons.length-1].url:v;var f="";t&&1==t[u.id]&&(f="locked");var p=u.isApp?"data-app":"",k='<li data-id="'+u.id+'" data-homepageurl="'+u.homepageUrl+'" data-optionurl="'+u.optionsUrl+'" data-name="'+u.shortName+'" style="background-image:url(\''+g+"')\" "+f+" "+p+"><i>APP</i></li>";u.icons&&u.icons.length>0&&function(t,e){setTimeout(function(){r(t,e.id)},0)}(u.icons[0].url,u),u.enabled===!1?l.push(k):"locked"===f?s.unshift(k):n.push(k)}}"rank"===Storage.get("_radio_ext_sort_")?(s.sort(i()),n.sort(i()),l.sort(i())):(s.sort(o()),n.sort(o()),l.sort(o()));var w=s.concat(n);d.html(w.join("")),0===l.length&&(d.addClass("hideListIsNull"),0===w.length&&m.addClass("allListIsEmpty")),h.html(l.join("")),e()})}function e(){if(!Storage.get("_switch_show_badge_")){var t=i(),e=0;$("#showList li").each(function(a,i){var o=$(i).data("id");t&&"1"!==t[o]&&e++}),0===e?chrome.browserAction.setBadgeText({text:""}):(chrome.browserAction.setBadgeBackgroundColor({color:"#f44336"}),chrome.browserAction.setBadgeText({text:e+""}))}}function a(){var t=$("[data-right]");t.length>0&&(t.removeAttr("data-right").removeClass("hover"),g.removeAttr("style")),$(".dinginess").removeClass("dinginess"),u.removeClass("extName-anim").attr("style","").empty()}function i(){return Storage.get("_lockList_")||{}}function o(){if(!y){y=setTimeout(function(){clearTimeout(y),y=null},1e3);var t=d.find("li");t.each(function(t,e){var a=$(e),i=a.data("id");""!==a.attr("locked")&&(h.append(a),chrome.management.setEnabled(i,!1,function(){}))}),chrome.browserAction.setBadgeText({text:""});var e=$("#showList li[locked]").removeAttr("locked");setTimeout(function(){e.attr("locked","")},0)}}function r(t,e){function a(t){var a=document.getElementById("getColorByCanvas");a.width=t.width,a.height=t.height;var i=a.getContext("2d");i.drawImage(t,0,0);for(var o=i.getImageData(0,0,t.width,t.height).data,r=0,n=0,s=0,l=180,c=1e3,d=0;d<t.height;d++)for(var h=0;h<t.width;h++){var m=o[4*(t.width*d+h)],u=o[4*(t.width*d+h)+1],g=o[4*(t.width*d+h)+2];255!=m&&255!=u&&255!=g&&h<c&&(c=h),m>l&&u>l&&g>l||(r+=m,n+=u,s+=g)}r/=t.width*t.height,n/=t.width*t.height,s/=t.width*t.height,r=Math.round(r),n=Math.round(n),s=Math.round(s);var p="rgb("+r+","+n+","+s+")";return r>l&&n>l&&s>l&&(p=f),1e3===c&&(setTimeout(function(){$("[data-id="+e+"]").css({"background-image":"url("+v+")"})},0),p=f),{color:p,substantial:c}}var i=new Image;i.crossOrigin="Anonymous",i.src=t,i.onload=function(){var t=a(i);A[e]||(A[e]={}),A[e].color=t.color,A[e].substantial=t.substantial,$("li[data-id="+e+"] > i").css("background",t.color)}}document.title=chrome.i18n.getMessage("extName");var n=$("body"),s=$(".js-dblclick-btn"),l=$(".js-searcher");n.attr("data-lan",chrome.i18n.getMessage("@@ui_locale")),$("#tips .title").html(chrome.i18n.getMessage("tipsTitle")),$("#tips .con").html(chrome.i18n.getMessage("tipsCon")),$("#rightMenu li.option").html(chrome.i18n.getMessage("rightOption")),$("#rightMenu li.applaunch").html(chrome.i18n.getMessage("rightAppLaunch")),$("#rightMenu li.uninstall").html(chrome.i18n.getMessage("rightUninstall")),$("#rightMenu li.homepage").html(chrome.i18n.getMessage("rightHomepage")),s.html(chrome.i18n.getMessage("closeAllBtn")),l.attr("placeholder",chrome.i18n.getMessage("searcherPlaceholder"));var c=$("#tips .url");c.html(chrome.i18n.getMessage("tipsUrl")),c.attr("href",c.attr("href")+chrome.i18n.getMessage("@@ui_locale"));var d=$("#showList"),h=$("#hideList"),m=$("#wrap"),u=$("#extName"),g=$("#rightMenu"),f="#5c5e6f",v="../icon/default-icon.png",p=null,k=null,w=null,_=null,b=null;SubTask("Storage",function(e){b={_key:"_rankList_",get:function(t){var a=e.get(this._key),i=0;return a&&a[t]&&(i=parseInt(a[t])),i},setRank:function(t){var a=e.get(this._key)||{};a[t]?a[t]=parseInt(a[t])+1:a[t]=1,e.set(this._key,a)}},p="close"!==e.get("_switch_show_extname_"),k="close"!==e.get("_switch_right_more_"),w=e.get("_showIconSize_")||2,t()}),m.on("click","li",function(t){t.preventDefault();var a=$(this),i=a.data("id"),o=1===a.closest("#hideList").length;i&&a.hasClass("hover")&&(a.removeClass("hover"),u.removeClass("extName-anim").attr("style","").empty(),o?(d.append(a),b.setRank(i)):h.append(a),a.attr("data-leftClick",1*new Date),0===h.find("li").length?d.addClass("hideListIsNull"):d.removeClass("hideListIsNull"),chrome.management.setEnabled(i,o,function(){})),e()}),$(document).on("click",function(){a()});var C={1:18,2:22,3:26};m.on("mouseenter","li",function(){var t=$(this),e=t.attr("data-id"),a=$("[data-right]"),i=a.attr("data-id");if(void 0===m.attr("searching")||void 0!=t.attr("searched")){if(e===i)return!1;if(a.length>0){a.removeAttr("data-right").removeClass("hover"),g.removeAttr("style");var o=t.closest("#showList").length>0?$("#hideList"):$("#showList");o.removeClass("dinginess")}var r="right",s=t.offset(),l=s.left+50-10,c=l+C[w],d=t.outerWidth(),h=t.outerHeight(),f=n.outerWidth(),v=u.html(t.attr("data-name")).outerWidth(),k=g.outerWidth(),_=g.outerHeight(),b=Math.max(v,k),y=f-s.left-d-C[w]+10,M=s.left-C[w]+10,x=Math.max(M,y);b>y&&y<M&&(l=s.left-v+10,c=l>C[w]?l-C[w]:0,r="left"),v>x&&(v=x-6,u.css({width:v,overflow:"hidden","text-overflow":"ellipsis"}),"left"==r&&(c+=6)),A[e]||(A[e]={}),A[e].left1=l,A[e].left2=c,"left"==r&&(A[e].left1=v>k?l+(v-k):l-(k-v),A[e].left2=v>k?c+(v-k):c-(k-v)),A[e].top=_>h?s.top-(_-h)/2:s.top+(h-_)/2,A[e]&&u.css("background-color",A[e].color),u.css({top:s.top+15,left:l});var L=t.closest(".list");clearTimeout(window["timer_disable_dinginess_"+L.attr("id")]),window["timer_"+t.data("id")]=setTimeout(function(){1*new Date<1*t.attr("data-leftclick")+200||(t.addClass("hover"),p&&(L.addClass("dinginess"),u.addClass("extName-anim").css({left:c,opacity:1})))},100)}}).on("mouseleave","li",function(){var t=$(this),e=t.closest(".list");return void 0==t.attr("data-right")&&(p&&(window["timer_disable_dinginess_"+e.attr("id")]=setTimeout(function(){e.removeClass("dinginess")},300),u.removeClass("extName-anim").attr("style","").empty()),t.removeClass("hover"),void clearTimeout(window["timer_"+t.data("id")]))});var y=null;s.click(function(){o()}),l.focus(),l.on("input",function(){var t=$(this),e=t.val().trim().replace(/\s{2,}/g," ").toLowerCase(),a={};if($("[searched]").removeAttr("searched"),e){m.attr("searching","");for(var i=e.split(/\s/),o=_.length-1;o>=0;o--)for(var r=i.length-1;r>=0;r--){var n=(_[o].name+"  "+_[o].description).toLowerCase();n.indexOf(i[r])!==-1&&(a[_[o].id]=1)}for(var s in a)$("[data-id="+s+"]").attr("searched","")}else m.removeAttr("searching")}).hover(function(){$(this).select()},function(){}),n.on("click",function(t){$.contains(document.getElementById("searchBox"),t.target)||(l.val(""),m.removeAttr("searching"))}),$(".js-search-empty").on("click",function(){l.val(""),m.removeAttr("searching"),l.focus()}),$(document).on("mousedown","#hideList>li, #showList>li",function(t){var e=$(this),i=e.data("id"),o=void 0!=e.attr("locked"),r=e.data("optionurl"),n=""===e.data("app"),s=e.data("homepageurl"),l=$("[data-right]"),c=1===e.closest("#hideList").length;if(l.length>0&&l.data("id")===i&&a(),2===t.button&&e.hasClass("hover")&&k){u.removeClass("extName-anim").attr("style","").empty(),e.attr("data-right",""),g.css({"background-color":A[i]?A[i].color:f,top:A[i].top,left:A[i].left1}).show(),o?g.find("li.lock").attr("locked","").html(chrome.i18n.getMessage("rightLock_unlock")):g.find("li.lock").removeAttr("locked").html(chrome.i18n.getMessage("rightLock_lock"));var d=g.find("li.applaunch").hide(),h=g.find("li.option").hide();n?c?d.attr("disabled","").show():d.removeAttr("disabled").show():(h.show(),$.trim(r)?h.removeAttr("disabled"):h.attr("disabled","")),$.trim(s)?g.find("li.homepage").removeAttr("disabled"):g.find("li.homepage").attr("disabled",""),setTimeout(function(){g.css({left:A[i].left2,opacity:1})},0)}}),$(document).on("contextmenu",function(t){return!1}),$("#rightMenu").on("click","li",function(t){t.preventDefault(),t.stopPropagation();var o=$(this),r=$("[data-right]"),n=r.attr("data-id");switch(a(),o.attr("class")){case"lock":var s=i();void 0===o.attr("locked")?(r.attr("locked",""),s[n]="1"):(r.removeAttr("locked"),delete s[n]),Storage.set("_lockList_",s),e();break;case"option":void 0===o.attr("disabled")&&chrome.tabs.create({url:r.data("optionurl")});break;case"homepage":void 0===o.attr("disabled")&&chrome.tabs.create({url:r.data("homepageurl")});break;case"uninstall":chrome.management.uninstall(n,function(){});break;case"applaunch":chrome.management.launchApp(n,function(){})}});var A={}})();