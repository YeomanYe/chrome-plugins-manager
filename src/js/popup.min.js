(function(){function t(){var t=i();SubTask("Extension",function(a){function i(){return function(t,e){return b.get($(e).data("id"))-b.get($(t).data("id"))}}function o(){return function(t,e){return $(t).data("name").charCodeAt(0)-$(e).data("name").charCodeAt(0)}}_=a;for(var n=[],s=[],l=[],c=0;c<a.length;c++){var m=a[c];if(m.id!==chrome.app.getDetails().id&&"theme"!==m.type){var g="";g=m.icons&&m.icons.length>0?m.icons[m.icons.length-1].url:v;var f="";t&&1==t[m.id]&&(f="locked");var p='<li data-id="'+m.id+'" data-homepageurl="'+m.homepageUrl+'" data-optionurl="'+m.optionsUrl+'" data-name="'+m.shortName+'" style="background-image:url('+g+')" '+f+"></li>";m.icons&&m.icons.length>0&&function(t,e){setTimeout(function(){r(t,e.id)},0)}(m.icons[0].url,m),m.enabled===!1?l.push(p):"locked"===f?s.unshift(p):n.push(p)}}"rank"===Storage.get("_radio_ext_sort_")?(s.sort(i()),n.sort(i()),l.sort(i())):(s.sort(o()),n.sort(o()),l.sort(o()));var w=s.concat(n);d.html(w.join("")),0===l.length&&(d.addClass("hideListIsNull"),0===w.length&&u.addClass("allListIsEmpty")),h.html(l.join("")),e()})}function e(){if(!Storage.get("_switch_show_badge_")){var t=i(),e=0;$("#showList li").each(function(a,i){var o=$(i).data("id");t&&"1"!==t[o]&&e++}),0===e?chrome.browserAction.setBadgeText({text:""}):(chrome.browserAction.setBadgeBackgroundColor({color:"#f44336"}),chrome.browserAction.setBadgeText({text:e+""}))}}function a(){var t=$("[data-right]");t.length>0&&(t.removeAttr("data-right").removeClass("hover"),g.removeAttr("style")),$(".dinginess").removeClass("dinginess"),m.removeClass("extName-anim").attr("style","").empty()}function i(){return Storage.get("_lockList_")||{}}function o(){if(!y){y=setTimeout(function(){clearTimeout(y),y=null},1e3);var t=d.find("li");t.each(function(t,e){var a=$(e),i=a.data("id");""!==a.attr("locked")&&(h.append(a),chrome.management.setEnabled(i,!1,function(){}))}),chrome.browserAction.setBadgeText({text:""});var e=$("#showList li[locked]").removeAttr("locked");setTimeout(function(){e.attr("locked","")},0)}}function r(t,e){function a(t){var a=document.getElementById("getColorByCanvas");a.width=t.width,a.height=t.height;var i=a.getContext("2d");i.drawImage(t,0,0);for(var o=i.getImageData(0,0,t.width,t.height).data,r=0,n=0,s=0,l=180,c=1e3,d=0;d<t.height;d++)for(var h=0;h<t.width;h++){var u=o[4*(t.width*d+h)],m=o[4*(t.width*d+h)+1],g=o[4*(t.width*d+h)+2];255!=u&&255!=m&&255!=g&&h<c&&(c=h),u>l&&m>l&&g>l||(r+=u,n+=m,s+=g)}r/=t.width*t.height,n/=t.width*t.height,s/=t.width*t.height,r=Math.round(r),n=Math.round(n),s=Math.round(s);var p="rgb("+r+","+n+","+s+")";return r>l&&n>l&&s>l&&(p=f),1e3===c&&(setTimeout(function(){$("[data-id="+e+"]").css({"background-image":"url("+v+")"})},0),p=f),{color:p,substantial:c}}var i=new Image;i.crossOrigin="Anonymous",i.src=t,i.onload=function(){var t=a(i);x[e]||(x[e]={}),x[e].color=t.color,x[e].substantial=t.substantial}}document.title=chrome.i18n.getMessage("extName");var n=$("body"),s=$(".js-dblclick-btn"),l=$(".js-searcher");n.attr("data-lan",chrome.i18n.getMessage("@@ui_locale")),$("#tips .title").html(chrome.i18n.getMessage("tipsTitle")),$("#tips .con").html(chrome.i18n.getMessage("tipsCon")),$("#rightMenu li.option").html(chrome.i18n.getMessage("rightOption")),$("#rightMenu li.uninstall").html(chrome.i18n.getMessage("rightUninstall")),$("#rightMenu li.homepage").html(chrome.i18n.getMessage("rightHomepage")),s.html(chrome.i18n.getMessage("closeAllBtn")),l.attr("placeholder",chrome.i18n.getMessage("searcherPlaceholder"));var c=$("#tips .url");c.html(chrome.i18n.getMessage("tipsUrl")),c.attr("href",c.attr("href")+chrome.i18n.getMessage("@@ui_locale"));var d=$("#showList"),h=$("#hideList"),u=$("#wrap"),m=$("#extName"),g=$("#rightMenu"),f="#5c5e6f",v="../icon/default-icon.png",p=null,w=null,k=null,_=null,b=null;SubTask("Storage",function(e){b={_key:"_rankList_",get:function(t){var a=e.get(this._key),i=0;return a&&a[t]&&(i=parseInt(a[t])),i},setRank:function(t){var a=e.get(this._key)||{};a[t]?a[t]=parseInt(a[t])+1:a[t]=1,e.set(this._key,a)}},p="close"!==e.get("_switch_show_extname_"),w="close"!==e.get("_switch_right_more_"),k=e.get("_showIconSize_")||2,t()}),u.on("click","li",function(t){t.preventDefault();var a=$(this),i=a.data("id"),o=1===a.closest("#hideList").length;i&&a.hasClass("hover")&&(a.removeClass("hover"),m.removeClass("extName-anim").attr("style","").empty(),o?(d.append(a),b.setRank(i)):h.append(a),a.attr("data-leftClick",1*new Date),0===h.find("li").length?d.addClass("hideListIsNull"):d.removeClass("hideListIsNull"),chrome.management.setEnabled(i,o,function(){})),e()}),$(document).on("click",function(){a()});var C={1:18,2:22,3:26};u.on("mouseenter","li",function(){var t=$(this),e=t.attr("data-id"),a=$("[data-right]"),i=a.attr("data-id");if(void 0===u.attr("searching")||void 0!=t.attr("searched")){if(e===i)return!1;if(a.length>0){a.removeAttr("data-right").removeClass("hover"),g.removeAttr("style");var o=t.closest("#showList").length>0?$("#hideList"):$("#showList");o.removeClass("dinginess")}var r="right",s=t.offset(),l=s.left+50-10,c=l+C[k],d=t.outerWidth(),h=t.outerHeight(),f=n.outerWidth(),v=m.html(t.attr("data-name")).outerWidth(),w=g.outerWidth(),_=g.outerHeight(),b=Math.max(v,w),y=f-s.left-d-C[k]+10,A=s.left-C[k]+10,M=Math.max(A,y);b>y&&y<A&&(l=s.left-v+10,c=l>C[k]?l-C[k]:0,r="left"),v>M&&(v=M-6,m.css({width:v,overflow:"hidden","text-overflow":"ellipsis"}),"left"==r&&(c+=6)),x[e]||(x[e]={}),x[e].left1=l,x[e].left2=c,"left"==r&&(x[e].left1=v>w?l+(v-w):l-(w-v),x[e].left2=v>w?c+(v-w):c-(w-v)),x[e].top=_>h?s.top-(_-h)/2:s.top+(h-_)/2,x[e]&&m.css("background-color",x[e].color),m.css({top:s.top+15,left:l});var L=t.closest(".list");clearTimeout(window["timer_disable_dinginess_"+L.attr("id")]),window["timer_"+t.data("id")]=setTimeout(function(){1*new Date<1*t.attr("data-leftclick")+200||(t.addClass("hover"),p&&(L.addClass("dinginess"),m.addClass("extName-anim").css({left:c,opacity:1})))},100)}}).on("mouseleave","li",function(){var t=$(this),e=t.closest(".list");return void 0==t.attr("data-right")&&(p&&(window["timer_disable_dinginess_"+e.attr("id")]=setTimeout(function(){e.removeClass("dinginess")},300),m.removeClass("extName-anim").attr("style","").empty()),t.removeClass("hover"),void clearTimeout(window["timer_"+t.data("id")]))});var y=null;s.click(function(){o()}),l.focus(),l.on("input",function(){var t=$(this),e=t.val().trim().replace(/\s{2,}/g," ").toLowerCase(),a={};if($("[searched]").removeAttr("searched"),e){u.attr("searching","");for(var i=e.split(/\s/),o=_.length-1;o>=0;o--)for(var r=i.length-1;r>=0;r--){var n=(_[o].name+"  "+_[o].description).toLowerCase();n.indexOf(i[r])!==-1&&(a[_[o].id]=1)}for(var s in a)$("[data-id="+s+"]").attr("searched","")}else u.removeAttr("searching")}).hover(function(){$(this).select()},function(){}),n.on("click",function(t){$.contains(document.getElementById("searchBox"),t.target)||(l.val(""),u.removeAttr("searching"))}),$(".js-search-empty").on("click",function(){l.val(""),u.removeAttr("searching"),l.focus()}),$(document).on("mousedown","#hideList>li, #showList>li",function(t){var e=$(this),i=e.data("id"),o=void 0!=e.attr("locked"),r=e.data("optionurl"),n=e.data("homepageurl"),s=$("[data-right]");s.length>0&&s.data("id")===i&&a(),2===t.button&&e.hasClass("hover")&&w&&(m.removeClass("extName-anim").attr("style","").empty(),e.attr("data-right",""),g.css({"background-color":x[i]?x[i].color:f,top:x[i].top,left:x[i].left1}).show(),o?g.find("li.lock").attr("locked",""):g.find("li.lock").removeAttr("locked"),$.trim(r)?g.find("li.option").removeAttr("disabled"):g.find("li.option").attr("disabled",""),$.trim(n)?g.find("li.homepage").removeAttr("disabled"):g.find("li.homepage").attr("disabled",""),setTimeout(function(){g.css({left:x[i].left2,opacity:1})},0))}),$(document).on("contextmenu",function(t){return!1}),$("#rightMenu").on("click","li",function(t){t.preventDefault(),t.stopPropagation();var o=$(this),r=$("[data-right]"),n=r.attr("data-id");switch(a(),o.attr("class")){case"lock":var s=i();void 0===o.attr("locked")?(r.attr("locked",""),s[n]="1"):(r.removeAttr("locked"),delete s[n]),Storage.set("_lockList_",s),e();break;case"option":void 0===o.attr("disabled")&&chrome.tabs.create({url:r.data("optionurl")});break;case"homepage":void 0===o.attr("disabled")&&chrome.tabs.create({url:r.data("homepageurl")});break;case"uninstall":chrome.management.uninstall(n,function(){})}});var x={}})();